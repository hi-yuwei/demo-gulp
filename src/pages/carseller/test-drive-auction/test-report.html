<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1" />
		<title>检测报告</title>
		<link rel="stylesheet" href="../../../assets/css/base.css?_=1">
		<link rel="stylesheet" type="text/css" href="../../../assets/css/lib/swiper/swiper.min.css" />
		<link rel="stylesheet" type="text/css" href="../../../assets/css/test-report.css"/>
		<!-- <script src="https://cdn.bootcss.com/vConsole/3.2.2/vconsole.min.js"></script> -->
	</head>
	<body>
		<div>
			<!-- 评估师信息 -->
			<div class="point-info">
				<!-- <div class="info-item"><span>评估师:</span>评估师</div>
				<div class="info-item"><span>评估时间:</span>评估师</div>
				<div class="info-item"><span>综合评分：</span>评估师</div> -->
			</div>
			<!-- 整体评价 -->
			<div class="evaluate-info">
				<div class="title">整体评价</div>
				<div class="info-wrapper">
					<!-- <div class="info-item">
						<div class="name">外观评价：</div>
						<div class="content">套用模型省时省力，不用冥思苦想，但是，每一个需要设计的内容和体系应该是迥然不同的，所以每一个设计方案也都应该是不可复制的</div>
					</div>$('.evaluate-info .info-wrapper')
					<div class="info-item">
						<div class="name">外观评价：</div>
						<div class="content">套用模型省时省力，不用冥思苦想，但是，每一个需要设计的内容和体系应该是迥然不同的，所以每一个设计方案也都应该是不可复制的</div>
					</div>
					<div class="info-item">
						<div class="name">外观评价：</div>
						<div class="content">套用模型省时省力，不用冥思苦想，但是，每一个需要设计的内容和体系应该是迥然不同的，所以每一个设计方案也都应该是不可复制的</div>
					</div> -->
				</div>
			</div>
			<!-- 检测信息 -->
			<div class="detection-info">
				<!-- <div class="detection-info-item">
					<div class="item-type flex-between">
						<div class="title">外观检测</div>
						<div class="num">共<span>50项</span>检测，发现<span>20处</span>缺陷<img src="../../activity/img/icon-arrow-down.png"></div>
					</div>
					<div class="appearance-box">
						<img src="https://erp-explain.car-me.com/weixin_static/bixin/appearance.png">
						<div class="list-wrapper">
							<div class="head-stock">
								<img src="../img/oval-icon.png" class="oval-icon">
								<span style="">车头</span>
							</div>
							<div class="engine-hatch">
								<img src="../img/oval-icon.png" class="oval-icon">
								<span>发动机舱盖</span>
							</div>
							<div class="left-front-wheel">
								<img src="../img/oval-icon.png" class="oval-icon">
								<p>左前轮</p>
							</div>
							<div class="right-front-wheel">
								<img src="../img/oval-icon.png" class="oval-icon">
								<p>右前轮</p>
							</div>
							<div class="left-door">
								<span>左车门</span>
								<img src="../img/oval-icon.png" class="oval-icon">
							</div>
							<div class="right-door">
								<img src="../img/oval-icon.png" class="oval-icon">
								<span>右车门</span>
							</div>
							<div class="roof-cover">
								<img src="../img/oval-icon.png" class="oval-icon">
								<p>车顶盖</p>
							</div>
							<div class="left-rear-wheel">
								<img src="../img/oval-icon.png" class="oval-icon">
								<p>左后轮</p>
							</div>
							<div class="right-rear-wheel">
								<img src="../img/oval-icon.png" class="oval-icon">
								<p>右后轮</p>
							</div>
							<div class="car-trunk">
								<img src="../img/oval-icon.png" class="oval-icon">
								<span>后备箱</span>
							</div>
							<div class="vehicle-tail">
								<img src="../img/oval-icon.png" class="oval-icon">
								<span>车尾</span>
							</div>
						</div>
					</div>
					<div class="defect-wrapper">
						<div class="defect-item">
							<div class="flex-between position-name">
								<div><span class="num">1</span><span>左前门</span>发现2处缺陷</div>
								<div><img src="../../activity/img/icon-arrow-down.png" style="width: 13px;height: 8px;"></div>
							</div>
							<div class="item-list">
								<p class="fault-name" style="">划痕褪色</p>
								<p class="fault-type" style="">一元硬币尺寸以内划痕褪色</p>
								<div class="fault-imgs" style="">
									<img src="https://bld-erp-pic.oss-cn-shanghai.aliyuncs.com/usedCar/8659986993884.jpg">
									<img src="https://bld-erp-pic.oss-cn-shanghai.aliyuncs.com/carAuction/34937708041739.jpg">
									<img src="https://bld-erp-pic.oss-cn-shanghai.aliyuncs.com/carAuction/34913673872950.png">
									<img src="https://bld-erp-pic.oss-cn-shanghai.aliyuncs.com/carAuction/34913673872950.png">
								</div>
								<p class="fault-desc">关于损伤的描述关于损伤的描述关于损伤的描述关于损伤的描述关于损伤的描述</p>
							</div>
						</div>
					</div>
				</div> -->

			</div>
		</div>
		<!-- 大图 -->
		<div class="showBigImg">
			<div class="showBigImgWrap swiper-container">
				<div class="allImgBox swiper-wrapper">
					<!-- <div class="imgIte swiper-slide">
						<img src="https://bld-erp-pic.oss-cn-shanghai.aliyuncs.com/usedCar/140_店长1(test1)_1576736069334.jpg">
					</div>
					<div class="imgIte swiper-slide">
						<img src="https://bld-erp-pic.oss-cn-shanghai.aliyuncs.com/usedCar/140_店长1(test1)_1576736069334.jpg">
					</div> -->
				</div>
				<!-- 分页器 -->
				<!-- <div class="swiper-pagination"></div> -->
			</div>
		</div>
		<!-- 大图 -->
		<script src="../../../assets/js/lib/swiper/swiper.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../assets/js/lib/zepto/zepto.min.js"></script>
		<script src="../../../assets/js/common.js?_=5"></script>
		<script type="text/javascript">
			let env = common.getQuery().env,
				evaluateId = common.getQuery().evaluateId,myBigSwiper;
				// var vConsole = new VConsole();
			let initModule = {
				init: function() {
					this.loadData();
					this.bigImgSwiper();
				},
				// 大图-start
				bigImgSwiper: function() {
					myBigSwiper = new Swiper('.showBigImgWrap', {
						// pagination: {
						// 	el: '.swiper-pagination',
						// 	type: 'fraction',
						// },
					})
					$('.showBigImg').click(function() {
						$(".showBigImg").css('display', 'none'); //显示
					})
				},
				openBigImg: function() {
					var that = this;
					var $img = $('.detection-info .detection-info-item .defect-wrapper .fault-imgs');
					console.log($img)
					$img.on('click','li', function() {
						var arr = [];
						console.log($(this).parent())
						$(this).parent().children().each(function() {
							let obj = {
								// name: $(this)[0].text(),
								url: $(this).data('img-url')
							}
							arr.push(obj)
						})
						that.bigImgSlide(arr, $(this).index());
					})
					
				},
				bigImgSlide: function(scArr, posi) {
					$(".showBigImg").css('display', 'block'); //显示
					var str = "";
					for (var i = 0; i < scArr.length; i++) {
						str += '<div class="imgIte swiper-slide"><img src=' + scArr[i].url + ' alt="" style="height:auto"></div>'
					}
					$('.allImgBox').html(str);
					myBigSwiper.update();
					myBigSwiper.slideTo(posi, 0);
				},
				// 大图-end
				loadData: function() {
					let that = this;
					let param = {
						evaluateId: evaluateId ? evaluateId : '',
						// containNormal: true
					}

					common.ajax({
						url: common.erpDomain + '/overallUsedCar/testReport',
						param: param,
						success: function(res) {
							
							if (res.code === '1') {
								let {
									detectionInfo,
									evaluateInfo,
									pointInfo
								} = res.result;
								// 评估师信息
								let pointInfoStr = "";
								pointInfoStr = '<div class="info-item"><span>评估师:</span>' + pointInfo.detectionPerson + '</div>' +
									'<div class="info-item"><span>评估时间:</span>' + pointInfo.time + '</div>';
								// '<div class="info-item"><span>综合评分：</span>'+pointInfo.point+'</div>';
								$('.point-info').html(pointInfoStr);

								// 整体评价
								let evaluateInfoStr = "";
								evaluateInfo.map(item => {
									evaluateInfoStr += '<div class="info-item">' +
										'<div class="name">' + item.name + '：</div>' +
										'<div class="content">' + item.content + '</div>' +
										'</div>'
								})
								$('.evaluate-info .info-wrapper').html(evaluateInfoStr);

								var detectionInfoStr = "";
								detectionInfo.map(item => {
									let itemTypeStr = '',
										detectionStr = '';
									if (item.itemType === '0') {
										itemTypeStr = '外观检测';
										detectionStr = '<div class="appearance-box">' +
											'<img src="https://erp-explain.car-me.com/weixin_static/bixin/appearance.png">' +
											'<div class="list-wrapper">' +
											that.initAppearance(item.faultName) +
											'</div>' +
											'</div>';
									} else if (item.itemType === '1') {
										itemTypeStr = '内饰检测';
										detectionStr = '<div class="appearance-box">' +
											'<img src="https://erp-explain.car-me.com/weixin_static/bixin/interiortrim.png">' +
											'<div class="list-wrapper">' +
											that.initInteriortrim(item.faultName) +
											'</div>' +
											'</div>';
									} else if (item.itemType === '2') {
										itemTypeStr = '车身骨架检测';
										detectionStr = '<div class="appearance-box" style="height:231px">' +
											'<img src="https://erp-explain.car-me.com/weixin_static/bixin/bodyskeleton.png">' +
											'<div class="list-wrapper">' +
											that.initSkeleton(item.faultName) +
											'</div>' +
											'</div>';
									} else if (item.itemType === '3') {
										itemTypeStr = '机电检测'
									}
									detectionInfoStr += '<div class="detection-info-item">'+
															'<div class="item-type flex-between">'+
																'<div class="title">'+itemTypeStr+'</div>'+
																'<div class="num">共<span>'+item.itemCount+'项</span>检测，发现<span>' + item.faultCount +'处</span>缺陷<img class="rotate" src="../../activity/img/icon-arrow-down.png"></div>'+
															'</div>'+
															detectionStr + that.initItemLIst(item.itemList) +
														'</div>'
								})
								$(".detection-info").html(detectionInfoStr);
								that.openBigImg();
							}
						}
					})

					$('.detection-info').on('click', '.detection-info-item .item-type .num', function() {
						let cssFlag = $(this).parent().siblings().hasClass('hide');
						if (cssFlag) {
							$(this).parent().siblings().removeClass('hide');
							$(this).children('img').addClass('rotate');
						} else {
							$(this).parent().siblings().addClass('hide');
							$(this).children('img').removeClass('rotate');
						}
					})
					$('.detection-info').on('click', '.detection-info-item .defect-wrapper .defect-item .position-name', function() {
						let cssFlag = $(this).siblings().hasClass('hide');
						if (cssFlag) {
							$(this).siblings().removeClass('hide');
							$(this).children().children('img').addClass('rotate');
						} else {
							$(this).siblings().addClass('hide');
							$(this).children().children('img').removeClass('rotate');
						}
					})
				},
				initItemLIst: function(list){
					let that = this;
					let str = "";
					list.map((val1,index) => {
						str += '<div class="defect-wrapper">'+
							'<div class="defect-item">'+
								'<div class="flex-between position-name">'+
									'<div><span class="num">'+(index+1)+'、</span><span>'+val1.positionName+'</span>发现' + val1.item.length+ '处缺陷</div>'+
									'<div><img class="rotate" src="../../activity/img/icon-arrow-down.png" style="width: 13px;height: 8px;"></div>'+
								'</div>'+
								'<div class="item-list-wrapper">' + this.initItem(val1.item) + '</div>'+
							'</div>'+
						'</div>'
					})
					return str
				},
				initItem: function(list){
					let str = "";
					list.map(val => {
						let images = val.images.split(";");
						var imgStr = "",descStr="";
						if(val.images){
							imgStr = '<ul class="fault-imgs">';
							images.map( item => {
								if(item){
									let url = encodeURI(common.reportImgDomain + item) + "?x-oss-process=image/resize,m_fill,h_146,w_216";
									imgStr += '<li class="img-item" data-img-url="' + encodeURI(common.reportImgDomain + item) + '"><img src="'+ url +'"></li>'	
								}
							})
							imgStr = imgStr + '</ul>';
						}
						
						if(val.describe){
							descStr = '<p class="fault-desc">'+val.describe+'</p>';
						}
						str += '<div class="item-list">'+
							'<p class="fault-name">'+val.faultName+'</p>'+
							'<p class="fault-type">'+val.faultType+'</p>'+
								imgStr + descStr +
						'</div>'
					})
					return str
				},
				initAppearance: function(faultName) {
					let list = faultName.split(';');
					let appearanceStr = "";
					appearanceList.map(item => {
						list.map(val => {
							if (item.name === val) {
								item.isActive = true;
							}
						})
						if (item.textDirection === 'left' && item.isActive) {
							appearanceStr += '<div class="' + item.className + '">' +
								'<span>' + item.name + '</span>' +
								'<img src="../img/oval-icon.png" class="oval-icon">' +
								'</div>'
						} else if (item.textDirection === 'right' && item.isActive) {
							appearanceStr += '<div class="' + item.className + '">' +
								'<img src="../img/oval-icon.png" class="oval-icon">' +
								'<span>' + item.name + '</span>' +
								'</div>'
						} else if (item.textDirection === 'bottom' && item.isActive) {
							appearanceStr += '<div class="' + item.className + '">' +
								'<img src="../img/oval-icon.png" class="oval-icon">' +
								'<p>' + item.name + '</p>' +
								'</div>'
						}
					})
					return appearanceStr;
				},
				initInteriortrim: function(faultName) {
					let list = faultName.split(';');
					let interiortrimStr = "";
					interiortrimList.map(item => {
						list.map(val => {
							if (item.name === val) {
								item.isActive = true;
							}
						})
						if (item.textDirection === 'left' && item.isActive) {
							interiortrimStr += '<div class="' + item.className + '">' +
								'<span>' + item.name + '</span>' +
								'<img src="../img/oval-icon.png" class="oval-icon">' +
								'</div>'
						} else if (item.textDirection === 'right' && item.isActive) {
							interiortrimStr += '<div class="' + item.className + '">' +
								'<img src="../img/oval-icon.png" class="oval-icon">' +
								'<span>' + item.name + '</span>' +
								'</div>'
						} else if (item.textDirection === 'bottom' && item.isActive) {
							interiortrimStr += '<div class="' + item.className + '">' +
								'<img src="../img/oval-icon.png" class="oval-icon">' +
								'<p>' + item.name + '</p>' +
								'</div>'
						} else if (item.textDirection === 'top' && item.isActive) {
							interiortrimStr += '<div class="' + item.className + '">' +
								'<p>' + item.name + '</p>' +
								'<img src="../img/oval-icon.png" class="oval-icon">' +

								'</div>'
						}
					})
					return interiortrimStr;
				},
				initSkeleton: function(faultName) {
					let list = faultName.split(';');
					let skeletonStr = "";
					skeletonList.map(item => {
						list.map(val => {
							if (item.name === val) {
								item.isActive = true;
							}
						})
						if (item.isActive) {
							skeletonStr += '<div class="' + item.className + '">' +
								'<img src="../img/oval-icon.png" class="oval-icon">' +
								'<p>' + item.name + '</p>' +
								'</div>'
						}
					})
					return skeletonStr;
				},
			}
			initModule.init();
			let appearanceList = [{
					name: '车头',
					className: 'head-stock',
					textDirection: 'right',
					isActive: false
				},
				{
					name: '发动机舱盖',
					className: 'engine-hatch',
					textDirection: 'right',
					isActive: false
				},
				{
					name: '左前轮',
					className: 'left-front-wheel',
					textDirection: 'bottom',
					isActive: false
				},
				{
					name: '右前轮',
					className: 'right-front-wheel',
					textDirection: 'bottom',
					isActive: false
				},
				{
					name: '左车门',
					className: 'left-door',
					textDirection: 'left',
					isActive: false
				},
				{
					name: '右车门',
					className: 'right-door',
					textDirection: 'right',
					isActive: false
				},
				{
					name: '车顶盖',
					className: 'roof-cover',
					textDirection: 'bottom',
					isActive: false
				},
				{
					name: '左后轮',
					className: 'left-rear-wheel',
					textDirection: 'bottom',
					isActive: false
				},
				{
					name: '右后轮',
					className: 'right-rear-wheel',
					textDirection: 'bottom',
					isActive: false
				},
				{
					name: '后备箱',
					className: 'car-trunk',
					textDirection: 'right',
					isActive: false
				},
				{
					name: '车尾',
					className: 'vehicle-tail',
					textDirection: 'right',
					isActive: false
				},
			]
			let interiortrimList = [{
					name: '操作台',
					className: 'car-console',
					textDirection: 'top',
					isActive: false
				},
				{
					name: '左前车门',
					className: 'left-front-door',
					textDirection: 'left',
					isActive: false
				},
				{
					name: '右前车门',
					className: 'right-front-door',
					textDirection: 'right',
					isActive: false
				},
				{
					name: '左前座椅',
					className: 'left-front-seat',
					textDirection: 'left',
					isActive: false
				},
				{
					name: '右前座椅',
					className: 'right-front-seat',
					textDirection: 'right',
					isActive: false
				},
				{
					name: '档位处',
					className: 'car-stalls',
					textDirection: 'bottom',
					isActive: false
				},
				{
					name: '左后车门',
					className: 'left-rear-door',
					textDirection: 'left',
					isActive: false
				},
				{
					name: '右后车门',
					className: 'right-rear-door',
					textDirection: 'right',
					isActive: false
				},
				{
					name: '左后座椅',
					className: 'left-rear-seat',
					textDirection: 'left',
					isActive: false
				},
				{
					name: '右后座椅',
					className: 'right-rear-seat',
					textDirection: 'right',
					isActive: false
				},
				{
					name: '第三排',
					className: 'the-third-row',
					textDirection: 'right',
					isActive: false
				},
			]
			let skeletonList = [{
					name: '1区',
					className: 'one-districts-before',
					textDirection: 'bottom',
					isActive: false
				},
				{
					name: '2区',
					className: 'one-districts',
					textDirection: 'bottom',
					isActive: false
				},
				{
					name: '1区',
					className: 'one-districts-after',
					textDirection: 'bottom',
					isActive: false
				},
			]
		</script>
	</body>
</html>
